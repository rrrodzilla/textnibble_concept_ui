#:kivy 2.0.0
#:import C kivy.utils.get_color_from_hex
#:import status models.order_status_enum.OrderStatus
#:import ConversationMessageWidget widgets.conversationmessagewidget
#:include ./widgets/conversationmessagewidget.kv
#:import Numpad widgets.numpad
#:include ./widgets/numpad.kv
#:import SubtotalEditor widgets.subtotaleditor
#:include ./widgets/subtotaleditor.kv
#:import KeypadButton widgets.keypadbutton
#:include ./widgets/keypadbutton.kv
#:set large_heading_opacity .35

<EstimateButton@ToggleButton>
    canvas.before:
        Color:
            rgb: C('#3F3F46') if not self.state == 'down' else C('#E4E4E7')
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [4, 4, 4, 4]
    background_color: 0, 0, 0, 0
    color: C('#E4E4E7') if not self.state == 'down' else C('#3F3F46')
    font_size: '16sp'
    group: 'time_estimate'
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    background_normal: ''
    markup: True

<PricingBoxLayout@BoxLayout>
    padding: 0, 0, 48, 0
<PriceLabel@Label>
#    canvas.before:
#        Color:
#            rgb: C('#FF0000')
#        Rectangle:
#            pos: self.pos
#            size: self.size
    font_name: 'Inter'
    markup: True
    size_hint: .35, 1
    font_size: 22
    text_size: self.size
    valign: 'center'
    halign: 'right'
    pos_hint: {'center_y': .5, 'center_x': 1}
<TotalLabel@Label>
#    canvas.before:
#        Color:
#            rgb: C('#0000FF')
#        Rectangle:
#            pos: self.pos
#            size: self.size
    font_name: './fonts/Inter-Thin.ttf'
    size_hint: .65, 1
    text_size: self.size
    valign: 'center'
    halign: 'right'
    markup: True
    font_size: 60
<SimpleButton@Button>:
    size_hint: 1, None
    size: [96, 64]
    font_name: 'Inter'
    font_size: 12
    pos_hint: {'center_y': .5}
<OrderDetailScreen>:
    current_order: root.manager.order_manager.current_order
    name: 'order_detail'
    time_estimate: root.time_estimate
    price_estimate: root.price_estimate
    canvas.before:
        Color:
            rgb: C('#18181B')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        size_hint: 1, 1
        pos_hint: {'center_y': .5, 'center_x': .5}
        orientation: 'vertical'
        BoxLayout:
            size_hint: 1, 1
            BoxLayout:
                id: conversation_layout
                orientation: 'vertical'
                size_hint: .3, 1
                pos_hint: {'center_y': .5}
                padding: 24
                Label:
                    text: 'Review'
                    color: C('#E5E5E5')
                    font_name: 'Inter'
                    opacity: large_heading_opacity
                    bold: True
                    font_size: 60
                    markup: True
                    text_size: self.size 
                    halign: 'left'
                    valign: 'middle'
                    size_hint: 1, None
                    height: '96dp'
                ScrollView:
#                   canvas.before:
#                       Color:
#                           rgb: C('#00FF00')
#                       Rectangle:
#                           size: self.size
#                           pos: self.pos

                    id: scroll_view
                    pos_hint: {"center_x": .5}
                    width: conversation_layout.minimum_width
                    do_scroll_x: False
                    do_scroll_y: True
                    bar_width: 0
                    size_hint: 1, .95
                    GridLayout:
                        id: conversation
                        cols: 1
                        spacing: 60
#                        padding: 0, 0, 0, 60
                        padding: 0, 18, 0, 0
                        size_hint: 1, None
                        height: self.minimum_height
                        width: self.minimum_width
#                    canvas.before:
#                        Color:
#                            rgb: C('#00FF00')
#                        Rectangle:
#                            size: self.size
#                            pos: self.pos
                BoxLayout:
                    size_hint: 1, .05
                    orientation: 'horizontal'
                    spacing: 8
                    TextInput:
                        id: msg_input
                        font_name: 'Inter'
                        pos_hint: {"center_y": .5}
                        size_hint: .7, 1
                    Button:
                        pos_hint: {"center_y": .5}
                        on_press:root.send_order_message()
                        size_hint: .3, 1
                        disabled: msg_input.text == ''
                        text: 'Send'
            BoxLayout:
                id: quote_actions
                canvas.before:
                    Color:
                        rgb: C('#0F0F0F')
                    Rectangle:
                        size: self.size
                        pos: self.pos
                size_hint: 1, 1

                BoxLayout:
                    orientation: 'vertical'
                    spacing: '12dp'
                    padding: '48dp', '24dp', '48dp', '24dp'
                    pos_hint: {'top':1}
                    BoxLayout:
                        #  [padding_left, padding_top, padding_right, padding_bottom]
                        size_hint: 1, None
                        Label:
                            text: 'Price'
                            opacity: .3
                            color: C('#E4E4E7')
                            font_name: 'Inter'
                            bold: True
                            font_size: 60
                            opacity: large_heading_opacity
                            markup: True
                            text_size: self.size 
                            halign: 'left'
                            valign: 'middle'
                    BoxLayout:
                        spacing: '8dp'
#                       padding: '24dp', '0dp', '0dp', '0dp'
                        size_hint: 1, None
                        SubtotalEditor:
                            id: price_subtotal
                            heading_text: 'Subtotal'
                            on_updated: root.update_total()
                            size_hint: 1, 1
                            show_entry_button: True
                        SubtotalEditor:
                            id: tax
                            on_updated: root.update_total()
                            heading_text: 'Tax'
                            size_hint: 1, 1
                            show_entry_button: True
                        SubtotalEditor:
                            id: fee
                            size_hint: 1, None
                            heading_text: 'Textnibble Fee'
                            opacity: .4
                        SubtotalEditor:
                            id: total
                            heading_text: 'Total'
                            size_hint: 1, 1
                    BoxLayout:
                        #  [padding_left, padding_top, padding_right, padding_bottom]
#                       padding: '24dp', '0pd', '0dp', '0dp'
                        size_hint: 1, None
                        Label:
                            text: 'Estimate'
                            color: C('#E4E4E7')
                            font_name: 'Inter'
                            bold: True
                            font_size: 60
                            opacity: large_heading_opacity
                            markup: True
                            text_size: self.size 
                            halign: 'left'
                            valign: 'middle'
 
                    BoxLayout:
                        spacing: '48dp'
#                       padding: '24dp', '0dp', '0dp', '0dp'
                        size_hint: 1, None
                        EstimateButton:
                            text: '[size=24sp][b]5[/b][/size]\nmins or less'
                            on_press: root.toggle_pressed('should take 5 or less')
                        EstimateButton:
                            on_press: root.toggle_pressed('should take about 10')
                            text: '[size=24sp][b]10[/b][/size]\n mins'
                        EstimateButton:
                            text: '[size=24sp][b]15[/b][/size]\n mins'
                            on_press: root.toggle_pressed('should take about 15')
                        EstimateButton:
                            text: '[size=24sp][b]20[/b][/size]\n mins'
                            on_press: root.toggle_pressed('should take about 20')
                        EstimateButton: 
                            text: '[size=24sp][b]30[/b][/size]\n mins'
                            on_press: root.toggle_pressed('should take about 30')
                        EstimateButton:
                            text: '[size=24sp][b]45[/b][/size]\n mins'
                            on_press: root.toggle_pressed('should take about 45')
                        EstimateButton:
                            text: '[size=24sp][b]60[/b][/size]\n mins'
                            on_press: root.toggle_pressed('could take up to 60')
                        EstimateButton:
                            on_press: root.toggle_pressed('could take 60 or more')
                            text: '[size=24sp][b]60[/b][/size]\n mins or more'
                    BoxLayout:
                        Label: 
                            id: draft_price_quote
                            font_name:'Inter-Thin'
                            markup: True
                            font_size: '48sp'
                            text_size: self.size
                            text:  "Your order " + root.time_estimate + " minutes once you've paid " + root.price_estimate + " including our 75 cent Textnibble platform fee."
                    BoxLayout:
                        size_hint: 1, 1
#
